# 개발 로드맵 (JWT 로그인 완료 기준)

## 현재 완료

- [x] JWT 기반 로그인/인증(REST)

---

## P0. 기본 베이스(무조건 먼저) — “나중에 갈아엎는 비용”을 줄이는 뼈대

### P0-1. 프로젝트 공통 베이스

- [ ] 환경 분리(dev/prod) 및 설정 관리
  - application-dev.yml / application-prod.yml
  - CORS, Allowed Origins, WebSocket allowed origins 분리
  - .env / secrets 관리 (깃 제외)
- [ ] 공통 응답/에러 규격 통일
  - 성공 응답 포맷
  - ErrorRes(네가 쓰는 DTO)로 GlobalExceptionHandler 통일
  - 에러 코드(Enum) 설계 (AUTH*\*, ROOM*_, WS\__)
- [ ] 로깅/모니터링 기본 세팅
  - requestId(MDC) 또는 traceId
  - actuator(헬스체크), 서버 상태 확인
- [ ] DB 마이그레이션 도입 (강추)
  - Flyway 또는 Liquibase (테이블/인덱스 변경 이력 관리)

### P0-2. WebSocket 기본 인프라(가장 중요)

- [ ] Spring WebSocket + STOMP 세팅
- [ ] WebSocket 인증(핵심)
  - CONNECT 시 JWT 검증 (HandshakeInterceptor / ChannelInterceptor)
  - user principal 세팅 → /user/queue 사용 가능하게
- [ ] 룸 권한 체크 공통화
  - “해당 roomId에 이 user가 member인가?” 검증 유틸/서비스
- [ ] 메시지 규격 통일
  - Envelope: {type, roomId, sender, payload, ts}
  - 에러 메시지 규격: {code, message, details}

### P0-3. 프론트 베이스(React)

- [ ] 라우팅/가드
  - PrivateRoute(로그인 필요), 토큰 만료 처리(리프레시가 있다면)
- [ ] API 레이어 정리
  - axios 인스턴스(Authorization 헤더, 에러 인터셉터)
- [ ] WebSocket 클라이언트 베이스
  - connect/reconnect(지수 백오프)
  - subscribe 관리(방 나갈 때 unsubscribe)
- [ ] 상태관리 구조 확정
  - authStore, roomStore, rtcStore, boardStore (Zustand 추천)

> 여기(P0)까지가 “기본 베이스”. 이후 기능 개발이 빨라지고, 장애도 줄어듦.

---

## P1. 회의 서비스 MVP(핵심 사용자 흐름) — “방 만들고 들어가서 채팅/음성”

### P1-1. 룸/멤버 기본 기능(REST)

- [ ] 워크스페이스(선택) 또는 개인 룸 구조 결정
- [ ] 룸 생성/조회/입장/퇴장 API
- [ ] 초대 링크(기본 버전)
  - roomId 기반 invite token(만료 옵션은 P2)
- [ ] 룸 멤버십 관리
  - room_members 테이블
  - 호스트/참가자 role_in_room

### P1-2. 실시간 채팅(WS)

- [ ] /topic/room/{roomId}/chat
- [ ] JOIN/LEAVE 룸 이벤트 브로드캐스트
- [ ] 채팅 로그 저장(선택: MVP에서는 저장 or 미저장 결정)
- [ ] UX 최소 기능
  - 멘션/답장/고정은 P2로 미뤄도 됨(하지만 구조는 고려)

### P1-3. WebRTC 음성 통화(P2P Mesh)

- [ ] 시그널링 채널 구현
  - /topic/room/{roomId}/signal
  - types: PEER_JOIN, OFFER, ANSWER, ICE, PEER_LEAVE
- [ ] 2~4명 P2P 연결
  - 새 참가자 입장 시 피어 연결 생성 규칙 확정
- [ ] 기본 통화 UX
  - 마이크 on/off
  - 말하는 중 표시(간단히 audio level로)
- [ ] STUN 적용 + 배포 환경 테스트
  - TURN은 P2로 두되, 필요하면 빨리 추가

✅ P1 완료 시점 = “로그인 → 방 생성/입장 → 채팅 + 음성 회의” 가능

---

## P2. 협업 툴 느낌 만들기 — “화이트보드 + 문서화 + 초대/권한”

### P2-1. 화이트보드 MVP(이벤트 스트리밍 방식)

- [ ] 캔버스(펜/지우개) + 좌표 이벤트 broadcast
- [ ] 커서 프레즌스(다른 유저 커서 표시)
- [ ] 도형/텍스트 최소 기능
- [ ] 보드 내보내기(PNG)

### P2-2. 초대/권한/보안 강화

- [ ] 방 잠금(비밀번호) / 초대 링크 만료/1회용
- [ ] 호스트 권한
  - 강퇴, 음소거 강제, 발표자 지정
- [ ] Rate limit(채팅/보드 스팸 방지)
- [ ] 감사 로그(audit_logs) 적재

### P2-3. 회의 기록/노트/액션아이템

- [ ] 공유 노트(공동 편집)
- [ ] 액션아이템(담당자/기한/상태)
- [ ] 타임스탬프 북마크
- [ ] 회의 종료 시 “요약/키워드 태그”(초기엔 수동 요약도 OK)

---

## P3. FigJam급 완성도 — “동시편집 안정성 + 버전/리플레이 + 템플릿”

### P3-1. CRDT(Yjs) 기반 동기화(화이트보드 고도화)

- [ ] 이벤트 스트리밍 → CRDT로 전환(또는 병행)
- [ ] 보드 페이지/템플릿(회의록/브레인스토밍/칸반)
- [ ] 버전 히스토리 / 되돌리기(UNDO/REDO)
- [ ] 타임라인 리플레이(세션 재생)

### P3-2. 채팅 고도화

- [ ] 멘션/쓰레드/고정 메시지
- [ ] 파일/이미지 업로드 + 링크 미리보기
- [ ] 채팅 검색

### P3-3. 브레인스토밍 모드/투표/설문

- [ ] 타이머 + 익명 포스트잇
- [ ] 투표/설문(A/B/C) + 결과 실시간 공개

---

## P4. 운영/확장/실서비스 형태

### P4-1. 확장성

- [ ] 멀티 인스턴스 WS 대응
  - Redis Pub/Sub로 브로드캐스트
- [ ] WebRTC 확장: SFU 도입(선택)
  - LiveKit/mediasoup/Janus 중 택1
- [ ] TURN(coturn) 안정화

### P4-2. 운영 도구

- [ ] 관리자 페이지(유저/방/신고/로그)
- [ ] 오류 리포트/피드백
- [ ] 품질 지표(지연/패킷로스/bitrate) 표시 강화

---

# “지금 당장 다음 해야 할 우선순위 TOP 10”

1. WebSocket(STOMP) 기본 연결 + topic/app 구조 잡기
2. WS에서 JWT 인증(핸드셰이크/채널 인터셉터)
3. room / room_members 테이블 설계 + 룸 CRUD API
4. 룸 입장 시 WS subscribe / 나갈 때 unsubscribe + 정리
5. JOIN/LEAVE 이벤트 브로드캐스트(참가자 목록 실시간)
6. 채팅 메시지 전송/수신 + (선택) 저장
7. 시그널링 채널(signal) 구현(offer/answer/ice)
8. WebRTC P2P 2인 통화 성공 → 3~4인 확장
9. “대기실(마이크 테스트)” 간단 버전
10. 배포 환경에서 STUN/TURN 이슈 체크(문제 생기면 TURN 도입)
